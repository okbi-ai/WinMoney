<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | WinMoney</title>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: linear-gradient(135deg, #141e30, #243b55);
      color: white;
      margin: 0;
      text-align: center;
      min-height: 100vh;
    }
    header {
      background: #1f4068;
      padding: 15px;
      font-size: 22px;
      font-weight: bold;
    }
    .container {
      padding: 20px;
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin: 15px auto;
      width: 90%;
      max-width: 400px;
    }
    button {
      background: #4CAF50;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover { background: #45a049; }
    video {
      width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
    #points {
      font-size: 24px;
      color: #ffcc00;
    }
    #logout {
      background: #ff4444;
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <header>ğŸ† Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ WinMoney</header>
  <div class="container">

    <div class="card">
      <h2>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
      <p id="points">0 Ù†Ù‚Ø·Ø©</p>
    </div>

    <div class="card">
      <h2>ğŸ¥ Ø´Ø§Ù‡Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø±Ø¨Ø­</h2>
      <video id="adVideo" controls>
        <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
        Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
      </video>
      <button id="watchBtn">Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ù„Ø¥ÙƒÙ…Ø§Ù„</button>
      <p id="videoMsg"></p>
    </div>

    <div class="card">
      <h2>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h2>
      <input id="refLink" type="text" readonly style="width:90%;text-align:center;">
      <button id="copyLink">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
      <p>Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ù„Ø²ÙŠØ§Ø¯Ø© Ù†Ù‚Ø§Ø·Ùƒ!</p>
    </div>

    <button id="logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const pointsEl = document.getElementById("points");
    const video = document.getElementById("adVideo");
    const videoMsg = document.getElementById("videoMsg");
    const refLink = document.getElementById("refLink");

    let currentUser;

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        refLink.value = `https://okbi-ai.github.io/WinMoney/register.html?ref=${user.uid}`;

        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          pointsEl.innerText = docSnap.data().points + " Ù†Ù‚Ø·Ø©";
        } else {
          await setDoc(docRef, { points: 0 });
          pointsEl.innerText = "0 Ù†Ù‚Ø·Ø©";
        }
      } else {
        window.location.href = "login.html";
      }
    });

    // â±ï¸ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ (5 Ø¯Ù‚Ø§Ø¦Ù‚)
    document.getElementById("watchBtn").addEventListener("click", async () => {
      videoMsg.innerText = "ÙŠØ¬Ø¨ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒØ§Ù…Ù„Ù‹Ø§ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·...";
      video.play();
      const duration = 5 * 60 * 1000; // 5 Ø¯Ù‚Ø§Ø¦Ù‚

      setTimeout(async () => {
        const docRef = doc(db, "users", currentUser.uid);
        const docSnap = await getDoc(docRef);
        const currentPoints = docSnap.data().points || 0;
        const newPoints = currentPoints + 10; // +10 Ù†Ù‚Ø§Ø·
        await updateDoc(docRef, { points: newPoints });
        pointsEl.innerText = newPoints + " Ù†Ù‚Ø·Ø©";
        videoMsg.innerText = "ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 10 Ù†Ù‚Ø§Ø·.";
      }, duration);
    });

    // ğŸ”— Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
    document.getElementById("copyLink").addEventListener("click", () => {
      refLink.select();
      document.execCommand("copy");
      alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· âœ…");
    });

    // ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    document.getElementById("logout").addEventListener("click", () => {
      signOut(auth).then(() => window.location.href = "login.html");
    });
  </script>

</body>
</html>
