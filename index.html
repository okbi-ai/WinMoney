<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>WinMoney تسجيل</title>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

    // --- هنا ضع كود تهيئة Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyBy5Ki9Gkp1Zga1rUIwwdsLR8WAP0KKi0I",
      authDomain: "winmoney-site.firebaseapp.com",
      projectId: "winmoney-site",
      storageBucket: "winmoney-site.firebasestorage.app",
      messagingSenderId: "846822709351",
      appId: "1:846822709351:web:6f12778e2fc608e2601cc2",
      measurementId: "G-79M2BCQP4W"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- دالة تسجيل مستخدم جديد ---
    async function signupUser(email, password) {
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await addDoc(collection(db, "users"), {
          uid: user.uid,
          email: email,
          balance: 0,
          createdAt: serverTimestamp()
        });

        alert("تم التسجيل بنجاح!");
      } catch (error) {
        console.error(error);
        alert("خطأ: " + error.message);
      }
    }

    // --- دالة تسجيل الدخول ---
    async function loginUser(email, password) {
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        const q = query(collection(db, "users"), where("uid", "==", user.uid));
        const querySnapshot = await getDocs(q);
        querySnapshot.forEach((doc) => {
          const userData = doc.data();
          alert("تم تسجيل الدخول! رصيدك الحالي: " + userData.balance);
        });

      } catch (error) {
        console.error(error);
        alert("خطأ: " + error.message);
      }
    }

    // --- هذا هو المكان بالضبط لوضع اختبار تسجيل المستخدم الجديد ---
    // يمكنك تغييره لاحقًا بفورم على الموقع
    signupUser("test@example.com", "123456");

  </script>
</head>
<body>
  <h1>WinMoney</h1>
  <p>تم إعداد تسجيل المستخدمين وتجربة Firestore!</p>
</body>
</html>
